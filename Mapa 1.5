<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mapa Road Travel con mapas base seleccionables</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    .toggle-btn {
      position: absolute;
      top: 100px; left: 10px;
      z-index: 1001;
      background: #0078FF;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    #busqueda {
      position: absolute;
      top: 10px;
      left: 140px;
      z-index: 1001;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
      width: 220px;
    }

    #limpiar {
      position: absolute;
      top: 10px;
      left: 370px;
      z-index: 1001;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #eee;
      cursor: pointer;
    }

    .sidebar {
      position: absolute;
      top: 130px; left: 10px;
      z-index: 1000;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      font-family: sans-serif;
      display: none;
      min-width: 160px;
    }

    .sidebar label {
      display: block;
      margin-bottom: 8px;
      font-size: 15px;
      cursor: pointer;
    }

    .sidebar img.iconito {
      width: 20px;
      vertical-align: middle;
      margin-right: 5px;
    }

    .leaflet-control-layers {
      margin-top: 10px;
      right: 10px;
      left: auto;
    }

    .marker-cluster-small {
      background-color: rgba(255, 140, 0, 0.6);
      color: white;
      border: 2px solid orange;
    }
    .marker-cluster-small div { background-color: orange; }

    .marker-cluster-medium {
      background-color: rgba(255, 165, 0, 0.6);
      border: 2px solid orange;
    }
    .marker-cluster-medium div { background-color: orange; }

    .marker-cluster-large {
      background-color: rgba(255, 165, 0, 0.7);
      border: 2px solid darkorange;
    }
    .marker-cluster-large div { background-color: darkorange; }
  </style>
</head>
<body>

<button class="toggle-btn" onclick="toggleSidebar()">‚ò∞ Categor√≠as</button>
<input type="text" id="busqueda" placeholder="Buscar lugar o categor√≠a..." oninput="buscarLugar()" />
<button id="limpiar" onclick="limpiarBusqueda()">‚ùå</button>
<div class="sidebar" id="filtros">
  <strong>Categor√≠as del viaje:</strong>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<script>
const token = 'pk.eyJ1Ijoicm9hZHRyYXZlbCIsImEiOiJjbWNkdmVneDcwb2pqMmtwczU1Z2VlMW40In0.VAAxEDBKFtghq39g3nDadA';

const day = L.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/navigation-day-v1/tiles/{z}/{x}/{y}?access_token=${token}`, {
  tileSize: 512, zoomOffset: -1, attribution: '¬© Mapbox'
});
const night = L.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/navigation-night-v1/tiles/{z}/{x}/{y}?access_token=${token}`, {
  tileSize: 512, zoomOffset: -1, attribution: '¬© Mapbox'
});
const satellite = L.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token=${token}`, {
  tileSize: 512, zoomOffset: -1, attribution: '¬© Mapbox'
});
const streets = L.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/streets-v12/tiles/{z}/{x}/{y}?access_token=${token}`, {
  tileSize: 512, zoomOffset: -1, attribution: '¬© Mapbox'
});

const hora = new Date().getHours();
const baseInicial = (hora >= 6 && hora < 18) ? day : night;

const map = L.map('map', {
  center: [4.637, -75.570],
  zoom: 11,
  layers: [baseInicial]
});

L.control.layers({
  "üó∫Ô∏è D√≠a": day,
  "üåÉ Noche": night,
  "üåê Sat√©lite": satellite,
  "üß≠ Calles": streets
}, null, { position: 'topright', collapsed: false }).addTo(map);

const lugares = [
  {
    nombre: "Camping El Roble",
    descripcion: "Zona tranquila para acampar con ba√±os y electricidad.",
    imagen: "https://via.placeholder.com/300x150?text=Camping+El+Roble",
    lat: 4.640, lng: -75.570,
    icono: "https://i.imgur.com/PzahqTD.png",
    categoria: "Camping"
  },
  {
    nombre: "Mirador de Salento",
    descripcion: "Vista espectacular del Valle de Cocora.",
    imagen: "https://via.placeholder.com/300x150?text=Mirador",
    lat: 4.637, lng: -75.562,
    icono: "https://i.imgur.com/m9rAll4.png",
    categoria: "Miradores"
  },
  {
    nombre: "Restaurante La Trucha",
    descripcion: "Especialidad en trucha al ajillo.",
    imagen: "https://via.placeholder.com/300x150?text=Comidas",
    lat: 4.638, lng: -75.566,
    icono: "https://i.imgur.com/7Ux12pr.png",
    categoria: "Comidas"
  },
   {
    nombre: "Hospital Montenegro",
    descripcion: "Atencion primaria centro de salud montenegro.",
    imagen: "https://via.placeholder.com/300x150?text=Mirador",
    lat: 4.5638, lng: -75.7514,
    icono: "https://i.imgur.com/ySjyXI2.png",
    categoria: "Hospitales"
  },
     {
    nombre: "Centro de salud",
    descripcion: "centro de salud",
    imagen: "https://via.placeholder.com/300x150?text=Mirador",
    lat: 4.5638, lng: -75.7514,
    icono: "https://i.imgur.com/ySjyXI2.png",
    categoria: "Hospitales"
  }
];

const capas = {};
const marcadoresPorNombre = {};
const clusterGroup = L.markerClusterGroup();

lugares.forEach(l => {
  const icono = L.icon({ iconUrl: l.icono, iconSize: [40, 40], iconAnchor: [20, 40] });
  const marker = L.marker([l.lat, l.lng], { icon: icono });

  const popupHtml = `
    <strong>${l.nombre}</strong><br>
    <img src="${l.imagen}" style="width:100%;border-radius:6px;margin:5px 0;">
    <p>${l.descripcion}</p>
    <button onclick="mostrarRuta([${l.lat}, ${l.lng}])">üó∫Ô∏è C√≥mo llegar</button>
  `;

  marker.bindPopup(popupHtml);

  if (!capas[l.categoria]) capas[l.categoria] = L.layerGroup();
  capas[l.categoria].addLayer(marker);
  clusterGroup.addLayer(marker);
  marcadoresPorNombre[l.nombre.toLowerCase()] = marker;
});

map.addLayer(clusterGroup);

const iconosCategoria = {
  "Camping": "https://i.imgur.com/PzahqTD.png",
  "Comidas": "https://i.imgur.com/7Ux12pr.png",
  "Miradores": "https://i.imgur.com/m9rAll4.png",
  "Miradores": "https://i.imgur.com/ySjyXI2.png"
};

const contenedor = document.getElementById('filtros');
Object.keys(capas).forEach(cat => {
  const id = 'chk_' + cat.replace(/\s+/g, '_');
  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.id = id;
  checkbox.checked = true;
  checkbox.onchange = function () {
    capas[cat].eachLayer(m => this.checked ? clusterGroup.addLayer(m) : clusterGroup.removeLayer(m));
  };
  const label = document.createElement('label');
  label.htmlFor = id;

  const iconito = document.createElement('img');
  iconito.src = iconosCategoria[cat] || "https://i.imgur.com/8Yp0pGq.png";
  iconito.className = "iconito";

  label.appendChild(checkbox);
  label.appendChild(iconito);
  label.appendChild(document.createTextNode(" " + cat));
  contenedor.appendChild(label);
});

function buscarLugar() {
  const texto = document.getElementById("busqueda").value.toLowerCase().trim();
  if (!texto || texto.length < 2) {
    Object.values(capas).forEach(grupo => grupo.eachLayer(m => clusterGroup.addLayer(m)));
    return;
  }

  for (const nombre in marcadoresPorNombre) {
    if (nombre.includes(texto)) {
      const marcador = marcadoresPorNombre[nombre];
      map.setView(marcador.getLatLng(), 14);
      marcador.openPopup();
      return;
    }
  }

  Object.keys(capas).forEach(cat => {
    capas[cat].eachLayer(m => {
      if (cat.toLowerCase().includes(texto)) clusterGroup.addLayer(m);
      else clusterGroup.removeLayer(m);
    });
  });
}

function limpiarBusqueda() {
  document.getElementById("busqueda").value = "";
  buscarLugar();
}

function toggleSidebar() {
  const sidebar = document.getElementById('filtros');
  sidebar.style.display = (sidebar.style.display === 'none') ? 'block' : 'none';
}

function mostrarRuta(destino) {
  if (!navigator.geolocation) return alert("Tu navegador no soporta geolocalizaci√≥n");
  navigator.geolocation.getCurrentPosition(pos => {
    const origen = `${pos.coords.latitude},${pos.coords.longitude}`;
    const destinoStr = `${destino[0]},${destino[1]}`;
    const url = `https://www.google.com/maps/dir/?api=1&origin=${origen}&destination=${destinoStr}&travelmode=driving`;
    window.open(url, '_blank');
  }, () => alert("No se pudo obtener tu ubicaci√≥n"));
}
</script>
</body>
</html>
